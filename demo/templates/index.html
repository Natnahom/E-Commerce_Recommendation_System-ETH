<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ethiopian E-commerce Recommender</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>üá™üáπ Ethiopian E-commerce Product Recommender</h1>
            <p class="subtitle">Content-Based Recommendation System for Local Markets</p>
        </header>

        <div class="stats">
            <h2>System Statistics</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>{{ stats.total_products }}</h3>
                    <p>Total Products</p>
                </div>
                <div class="stat-card">
                    <h3>{{ stats.categories }}</h3>
                    <p>Categories</p>
                </div>
                <div class="stat-card">
                    <h3>${{ "%.2f"|format(stats.average_price) }}</h3>
                    <p>Average Price</p>
                </div>
                <div class="stat-card">
                    <h3>{{ "%.1f"|format(stats.average_rating) }}/5.0</h3>
                    <p>Average Rating</p>
                </div>
            </div>
        </div>

        <div class="demo-section">
            <h2>Try the Recommender</h2>
            
            <div class="sample-products">
                <h3>Sample Products</h3>
                <div class="products-grid">
                    {% for product in sample_products %}
                    <div class="product-card" onclick="recommendForProduct('{{ product.product_id }}')">
                        <h4>{{ product.name }}</h4>
                        <p class="category">{{ product.category }}</p>
                        <p class="price">${{ product.price }}</p>
                        <p class="rating">‚≠ê {{ product.rating }}</p>
                        <button class="recommend-btn">Get Recommendations</button>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <div class="recommendation-results" id="results" style="display: none;">
                <h3>Recommended Products</h3>
                <div id="recommendations-container"></div>
            </div>
        </div>

        <div class="search-section">
            <h3>Search for Recommendations</h3>
            <input type="text" id="searchInput" placeholder="Search for products...">
            <button onclick="searchRecommendations()">Search</button>
        </div>

        <footer>
            <p>Built for Ethiopian E-commerce Platforms | Content-Based Filtering</p>
            <p>Supports Amharic and English | Delivery-Aware Recommendations</p>
        </footer>
    </div>

    <script>
        function recommendForProduct(productId) {
            fetch('/recommend', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    product_id: productId,
                    context: {
                        location: 'Addis Ababa',
                        filter_delivery: true,
                        top_n: 5
                    }
                })
            })
            .then(response => response.json())
            .then(data => {
                displayRecommendations(data);
            });
        }

        function searchRecommendations() {
            const searchText = document.getElementById('searchInput').value;
            if (!searchText) return;

            fetch('/recommend', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    search_text: searchText,
                    context: {
                        location: 'Addis Ababa',
                        filter_delivery: true,
                        top_n: 5
                    }
                })
            })
            .then(response => response.json())
            .then(data => {
                displayRecommendations(data);
            });
        }

        function displayRecommendations(data) {
            const container = document.getElementById('recommendations-container');
            container.innerHTML = '';
            
            if (data.recommendations && data.recommendations.length > 0) {
                data.recommendations.forEach((product, index) => {
                    const productHTML = `
                        <div class="recommended-product">
                            <h4>${index + 1}. ${product.name}</h4>
                            <p>${product.description_english}</p>
                            <div class="product-details">
                                <span class="price">$${product.price}</span>
                                <span class="rating">‚≠ê ${product.rating}</span>
                                <span class="similarity">Similarity: ${product.similarity_score.toFixed(3)}</span>
                                <span class="delivery">${product.delivery_available === 'Yes' ? 'üöö Delivery Available' : 'üì¶ Pickup Only'}</span>
                            </div>
                        </div>
                    `;
                    container.innerHTML += productHTML;
                });
            } else {
                container.innerHTML = '<p>No recommendations found.</p>';
            }
            
            document.getElementById('results').style.display = 'block';
        }
    </script>
</body>
</html>